<style>
    .collapsible {
      background-color: #777;
      color: white;
      cursor: pointer;
      padding: 18px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 15px;
    }

    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

	.save_button {
		width: 10%;
		margin: 10px;
		padding: 2px 0px 2px 0px;
		text-align: center;
	}

	.save_button:hover {
		box-shadow: 0 3px 3px 0 rgba(0,0,0,0.24), 0 3px 3px 0 rgba(0,0,0,0.19);
	}

	.save_notification {
		text-align: center;
	}

	.explanation {
		font-size: large;
		margin-bottom: 40px;
	}

    .active, .collapsible:hover {
      background-color: #555;
    }

    .content {
      padding: 0 18px;
      overflow: hidden;
      background-color: #f1f1f1;
    }

    .table {
      border-collapse: collapse;
      width: 100%;
    }
</style>

<script>
	function saveChanges() {
	  var x = document.getElementById("changes_saved");
	  x.innerText = "Changes saved";
	  fadeOut(x)
	}

	function fadeOut(element) {
		var op = 1;  // initial opacity
		var timer = setInterval(function () {
			if (op <= 0.1){
				clearInterval(timer);
			}
			element.style.opacity = op;
			op -= 0.1;
		}, 200);
	}

	function sendChanges() {
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", "/cgi-bin/luci/admin/ids_tab/config/save");
		xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

		var config_json = {};
		config_json.mac_addrs = []

		// Build content from form via checked rows
		var selected_rows = document.getElementsByClassName("row_selector");
		var i;
		for (i = 0; i < selected_rows.length; i++) {
			if (selected_rows[i].checked) {
				var row_id = selected_rows[i].classList[1];
				config_json.mac_addrs.push(document.getElementsByClassName("mac " + row_id)[0].innerHTML)
			}
		}

		var config = JSON.stringify(config_json);
		xmlhttp.send(config);
		saveChanges()
	}
</script>

<body>
<h1>Configuration</h1>
<div class="explanation">
	<h2>Select the devices you wish to be checked using the IDS system</h2>
</div>
<p id="changes_saved" class="save_notification"></p>
<form action="/ids-priv/settings/" method="post">
<div>
    <div class="content">
        <table class="table">
            <tbody>
            <tr>
                <th></th>
                <th>IP Address</th>
                <th>MAC Address</th>
                <th>Interface</th>
            </tr>
            {%for device in neighboring_devices%}
            <tr>
                <td><input type="checkbox" name="{{device.mac}}"></td>
                <td>{{device.ip}}</td>
                <td>{{device.mac}}</td>
                <td>{{device.interface}}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <input type="submit" value="Save" class="save_button">
</div>
</form>
</body>